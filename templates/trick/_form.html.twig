<div>
    {{ form_start(form) }}
    {{ form_row(form.name) }}
    {{ form_row(form.description) }}
    {{ form_row(form.trickGroup) }}

    <ul class="illustrations" data-prototype="{{ form_widget(form.illustrations.vars.prototype)|e }}"
        data-index="{{ form.illustrations|length > 0 ? form.illustrations|last.vars.name + 1 : 0 }}">
    </ul>
    <button type="button" class="add_illustration_link btn btn-primary" data-collection-holder-class="illustrations">Ajouter une illustration</button>
    <div >
        {{ form_widget(form.illustrations) }}
    </div>
    <div data-prototype="{{ form_widget(form.videos.vars.prototype)|e }}">
        {{ form_widget(form.videos) }}
    </div>

    <div id="button-wrapper" class="my-3">
        <button class="btn btn-primary">Enregistrer</button>
        <button type="button" class="btn btn-secondary" onclick="window.history.back();">Retour</button>
    </div>

    {{ form_end(form) }}

    {% if trick is defined %}
        <form action="{{ path('app_trick_delete', { id: trick.id }) }}" method="post" class="d-inline">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ trick.id) }}">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes vous sûr de vouloir supprimer ce Trick ?')">
                Supprimer
            </button>
        </form>
    {% endif %}
</div>

<script>
    document
        .querySelectorAll('.add_illustration_link')
        .forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });

    function addFormToCollection(e) {
        const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

        const item = document.createElement('li');

        item.innerHTML = collectionHolder
            .dataset
            .prototype
            .replace(
                /__name__/g,
                collectionHolder.dataset.index
            );

        collectionHolder.appendChild(item);

        collectionHolder.dataset.index++;
    }
</script>

